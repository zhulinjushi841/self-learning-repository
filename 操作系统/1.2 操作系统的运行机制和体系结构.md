<!--
 * @Author: Jerome 841682441@qq.com
 * @Date: 2022-12-09 22:00:23
 * @LastEditors: Jerome 841682441@qq.com
 * @LastEditTime: 2022-12-09 22:31:21
 * @FilePath: \操作系统\1.2 操作系统的运行机制和体系结构.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->
##操作系统的运行机制和体系结构

预备知识：指令就是处理器(CPU)能识别、执行的最基本命令。
指令可以被分为两种：
(1)特权指令：如内存清零指令; 不允许用户程序使用
(2)非特权指令：如普通的运算指令。

CPU如何判断当前是否可以执行特权指令？

两种处理器状态：
(1)用户态(目态)，此时CPU仅能执行非特权指令
(2)核心态(管态)，可以执行特权指令和非特权指令
而具体的处理器状态就是使用程序状态字寄存器(PSW)中的某状态位来标识当前处理器中处于什么状态，如0为用户态，1为核心态。

针对上述两种不同状态，又可以将程序分为两种，分别是，
(1)内核程序：操作系统的核心内容，操作系统的内核程序是系统的管理者，既可以执行特权指令，也可以执行非特权指令，运行在核心态。
(2)应用程序：为了保证系统能够安全运行，普通用用程序只能执行非特权指令，运行在用户态。

**操作系统的内核**
计算机系统的层次结构：
从上层到底层分别为：
用户、应用程序(软件)、操作系统(包括非内核功能和内核)、裸机(纯硬件)
最接近硬件部分就是操作系统的内核，其中有操作系统最核心的一些功能。
其中内核又可以被分为与硬件紧密相关的时钟管理(用于实现计时功能)、中断管理和原语(包含有设备驱动、CPU切换等)。
**原语：**是一种特殊的程序，是最接近硬件的部分，这部分程序的运行具有原子性(其运行只能一气呵成，不可中断)。且运行时间较短，调用较为频繁。
原子性指的是一个不可中断的操作，要么全部执行成功、要么执行失败。在多个线程一起执行的时候，一个操作一旦开始，就不会被其他线程所干扰。

**内核**
内核是计算机上配置的底层软件，是操作系统最基本、最核心的部分。
实现操作系统内核功能的那些程序就是内核程序。

操作系统的体系结构可以被分为：大内核和微内核(仅包含一些必不可少的内核程序)

大内核是将操作系统的主要功能模块都作为系统内核，运行在核心态。
优点是高性能，缺点是内核代码庞大，结构混乱，难以维护。
微内核是只讲最基本的功能保留在内核。优点是内核功能少，结构清晰，方便维护。缺点是需要频繁地在核心态和用户态之间切换，性能低。

类比：操作系统的体系结构问题与企业的管理问题很类似。
内核就是企业的管理层，负责一些重要的工作。只有管理层才能执行特权指令，普通员工只能执行非特权命令。
用户态、核心态之间的切换就相当于普通员工和管理层之间的工作交接。
